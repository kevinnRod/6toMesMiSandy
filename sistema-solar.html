<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema solar ‚Äî Mi Sandy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    :root{ --pink1:#ffd1e3; --pink2:#ffc0d6; --accent:#ff2d6a; --deep:#7a1c6b; --card:#fff5f8; --ink:#5a2452; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; color:#6b3063; font-family:Poppins, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
      background:#000;
      overflow-y:auto; overflow-x:hidden;
    }
    body::before{content:""; position:fixed; inset:0; pointer-events:none; opacity:.2;
      background-image: radial-gradient(rgba(255,255,255,.7) 8px, transparent 10px), radial-gradient(rgba(255,255,255,.5) 6px, transparent 8px);
      background-size: 120px 120px, 180px 180px; background-position: 0 0, 40px 40px; mix-blend-mode: screen; z-index:0;
    }

    .container{max-width:1200px; margin:0 auto; padding: clamp(16px, 4vw, 36px); position:relative; z-index:2}

    .hero{ text-align:center; padding: clamp(18px,5vw,24px) 0 8px; }
    .hero h1{ --grad: linear-gradient(90deg, #ff4f87 0%, #ff2d6a 40%, #b72c7e 85%);
      margin:0; font-weight:900; letter-spacing:.6px; font-size: clamp(32px, 6.4vw, 58px);
      background: var(--grad); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent;
      filter: drop-shadow(0 10px 24px rgba(183,44,126,.25));
    }
    .hero .sub{ margin:.4rem 0 0; font-weight:700; color:#5a2452; opacity:.9 }

    /* ===== Navtabs ===== */
    .tabs-wrap{ display:grid; place-items:center; margin: 10px 0 20px; }
    .tabs{ display:flex; gap:10px; overflow:auto; padding:8px; width:min(95vw, 1100px); background:rgba(255,255,255,.75); backdrop-filter: blur(8px); border-radius:20px; box-shadow:0 10px 24px rgba(0,0,0,.12), inset 0 0 0 1px rgba(183,44,126,.12); }
    .tabs::-webkit-scrollbar{ display:none }
    .tab{ text-decoration:none; color:#b72c7e; font-weight:800; padding:10px 16px; border-radius:999px; border:1px solid transparent; white-space:nowrap; }
    .tab:hover{ background: rgba(255,255,255,.95) }
    .tab.is-active{ color:#fff; background: linear-gradient(135deg,#ff4f87,#ff2d6a); box-shadow: 0 10px 18px rgba(183,44,126,.35) }

    /* ===== Universo 3D (WebGL) ===== */
    .universe{ position:relative; height: calc(100vh - 220px); min-height:560px; border-radius:28px; overflow:hidden;
      box-shadow: 0 24px 48px rgba(122,28,107,.22), inset 0 0 0 1px rgba(183,44,126,.12);
      background: radial-gradient(1200px 800px at 50% 50%, rgba(255,255,255,.05), transparent 60%),
                  radial-gradient(1000px 600px at 20% 20%, rgba(255,255,255,.04), transparent 60%),
                  #000;
    }
    canvas#webgl{ display:block; width:100%; height:100% }

    /* Etiquetas 3D (CSS2D) */
    .label{ color:#fff; font-weight:900; letter-spacing:.3px; font-size:.9rem; padding:6px 10px; border-radius:999px; white-space:nowrap;
      background: linear-gradient(135deg,#ff4f87,#ff2d6a); box-shadow: 0 10px 18px rgba(183,44,126,.35); text-shadow:0 4px 12px rgba(0,0,0,.35);
      pointer-events:none; }

    .hud{ position:absolute; left:0; right:0; bottom:10px; display:flex; justify-content:center; gap:12px; color:#fff; font-weight:700; text-shadow:0 6px 14px rgba(0,0,0,.35); z-index:5 }
  </style>
</head>
<body>
  <div class="container">
    <header class="hero">
      <h1>Nuestro sistema solar</h1>
      <p class="sub">Gira, explora y toca los planetas con frases para ti ‚ú®</p>
    </header>

    <!-- NAVTABS -->
    <div class="tabs-wrap">
      <nav class="tabs" aria-label="Navegaci√≥n de sorpresas">
        <a class="tab" href="sorpresa.html">Este mes</a>
        <a class="tab" href="poster-6-meses.html">Poster 6 meses</a>
        <a class="tab" href="sistema-solar.html">Sistema solar</a>
        <a class="tab" href="galeria.html">Galer√≠a de fotos</a>
        <a class="tab" href="carta.html">Carta</a>
      </nav>
    </div>

    <!-- UNIVERSO 3D -->
    <section class="universe" role="region" aria-label="Sistema solar 3D">
      <canvas id="webgl"></canvas>
      <!-- <div class="hud">Arrastra para girar ‚Ä¢ Doble clic: enfocar planeta</div> -->
    </section>
  </div>

  <!-- Three.js + Import Map (ESM) -->
  <script async src="https://unpkg.com/es-module-shims@1.10.0/dist/es-module-shims.min.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
      }
    }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
    import { CSS2DRenderer, CSS2DObject } from 'https://unpkg.com/three@0.160.0/examples/jsm/renderers/CSS2DRenderer.js';

    const phrases = [
      'Primer pensamiento üí≠',
      'Mi dulce capibara ü´∂',
      'Mi hogar eres t√∫ üè†',
      'Tu risa es mi sol ‚òÄÔ∏è',
      'Amor gigante üíó',
      'Nos rodea la suerte ‚ú®',
      'Nuestro futuro brilla üåü',
      'Contigo, infinito ‚ôæÔ∏è'
    ];

    const canvas = document.getElementById('webgl');
    const scene = new THREE.Scene();
    scene.fog = null;

    // C√°mara
    const camera = new THREE.PerspectiveCamera(55, 1, 0.1, 5000);
    camera.position.set(0, 140, 900);

    // Render principal
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));

    // Render para etiquetas
    const labelRenderer = new CSS2DRenderer();
    labelRenderer.setSize(1,1);
    labelRenderer.domElement.style.position = 'absolute';
    labelRenderer.domElement.style.inset = '0';
    labelRenderer.domElement.style.pointerEvents = 'none';
    document.querySelector('.universe').appendChild(labelRenderer.domElement);

    // Luces
    const ambient = new THREE.AmbientLight(0xffffff, 0.25);
    scene.add(ambient);

    // Sol (emite luz)
    const sunGeo = new THREE.SphereGeometry(80, 64, 64);
    const sunMat = new THREE.MeshStandardMaterial({ color:0xffa200, emissive:0xff7b00, emissiveIntensity:1.2, roughness:0.5, metalness:0.1 });
    const sun = new THREE.Mesh(sunGeo, sunMat);
    scene.add(sun);

    const sunLight = new THREE.PointLight(0xffaa55, 3.2, 0, 2);
    sunLight.position.set(0,0,0);
    scene.add(sunLight);

    // Label "Mi Sandy" al centro
    const sandyEl = document.createElement('div');
    sandyEl.className = 'label';
    sandyEl.style.fontFamily = 'Great Vibes, cursive';
    sandyEl.style.fontSize = '24px';
    sandyEl.textContent = 'Mi Sandy';
    const sandyLabel = new CSS2DObject(sandyEl);
    sandyLabel.position.set(0, 0, 0);
    sun.add(sandyLabel);

    // Estrellas (puntos) ‚Äî dos capas: blancas y doradas
    const starGroup = new THREE.Group();
    scene.add(starGroup);
    function starField(count=3000, size=1.4, color=0xffffff, opacity=0.9){
      const geo = new THREE.BufferGeometry();
      const pos = new Float32Array(count*3);
      for(let i=0;i<count;i++){
        const r = 2200 * Math.cbrt(Math.random());
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(2*Math.random()-1);
        pos[i*3+0] = r*Math.sin(phi)*Math.cos(theta);
        pos[i*3+1] = r*Math.cos(phi);
        pos[i*3+2] = r*Math.sin(phi)*Math.sin(theta);
      }
      geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
      const mat = new THREE.PointsMaterial({ color, size, sizeAttenuation:true, transparent:true, opacity });
      const points = new THREE.Points(geo, mat);
      starGroup.add(points);
    }
    starField(3800, 1.2, 0xffffff, 0.9);
    starField(1600, 1.8, 0xfff2aa, 0.8);

    // Planetas (3D esferas) con orbits
    const planets = [];
    const cfg = [
      { r:150, size:18, color:0xeae0d6, speed:0.9 },
      { r:210, size:24, color:0xffb4c9, speed:0.7 },
      { r:270, size:28, color:0x6ec1ff, speed:0.55 },
      { r:330, size:24, color:0xff8a7a, speed:0.45 },
      { r:420, size:48, color:0xf7c38a, speed:0.35 },
      { r:520, size:40, color:0xf6e0a6, speed:0.28, rings:true },
      { r:600, size:30, color:0xb8e5ff, speed:0.22 },
      { r:680, size:30, color:0x86b5ff, speed:0.18 }
    ];

    const ringMat = new THREE.MeshBasicMaterial({ color:0xffffff, transparent:true, opacity:0.15, side:THREE.DoubleSide });

    cfg.forEach((c, i)=>{
      const pivot = new THREE.Object3D();
      scene.add(pivot);

      // √ìrbita visual (anillo fino)
      const ringGeo = new THREE.RingGeometry(c.r-0.5, c.r+0.5, 128);
      const orbit = new THREE.Mesh(ringGeo, ringMat);
      orbit.rotation.x = -Math.PI/2;
      scene.add(orbit);

      // Planeta
      const geo = new THREE.SphereGeometry(c.size, 48, 48);
      const mat = new THREE.MeshStandardMaterial({ color:c.color, roughness:0.6, metalness:0.05 });
      const mesh = new THREE.Mesh(geo, mat);
      mesh.position.x = c.r;

      // Etiqueta
      const el = document.createElement('div');
      el.className = 'label';
      el.textContent = phrases[i % phrases.length];
      const label = new CSS2DObject(el);
      label.position.set(0, c.size+10, 0);
      mesh.add(label);

      // Anillos tipo Saturno
      if(c.rings){
        const rg = new THREE.RingGeometry(c.size*1.4, c.size*2.2, 64);
        const rm = new THREE.MeshBasicMaterial({ color:0xffffff, transparent:true, opacity:0.55, side:THREE.DoubleSide });
        const ring = new THREE.Mesh(rg, rm);
        ring.rotation.x = Math.PI/3;
        mesh.add(ring);
      }

      pivot.add(mesh);

      planets.push({ pivot, mesh, speed:c.speed, r:c.r });
    });

    // Controles de c√°mara
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.minDistance = 140;
    controls.maxDistance = 1500;
    controls.target.set(0,0,0);

    // Doble click para enfocar el planeta m√°s cercano al cursor
    const raycaster = new THREE.Raycaster();
    const mouse = new THREE.Vector2();
    renderer.domElement.addEventListener('dblclick', (e)=>{
      const rect = renderer.domElement.getBoundingClientRect();
      mouse.x = ((e.clientX - rect.left)/rect.width)*2 - 1;
      mouse.y = -((e.clientY - rect.top)/rect.height)*2 + 1;
      raycaster.setFromCamera(mouse, camera);
      const meshes = planets.map(p=>p.mesh);
      const hits = raycaster.intersectObjects(meshes, false);
      if(hits.length){
        const p = hits[0].object;
        const target = p.getWorldPosition(new THREE.Vector3());
        controls.target.copy(target);
        const dir = camera.position.clone().sub(target).normalize();
        const dist = p.geometry.parameters.radius * 10 + 120;
        camera.position.copy(target.clone().add(dir.multiplyScalar(dist)));
        controls.update();
      }
    });

    // Doble-tap en m√≥vil
    let lastTap = 0;
    renderer.domElement.addEventListener('touchstart', (e)=>{
      const now = Date.now();
      if (now - lastTap < 350) {
        const t = e.changedTouches[0];
        const rect = renderer.domElement.getBoundingClientRect();
        mouse.x = ((t.clientX - rect.left)/rect.width)*2 - 1;
        mouse.y = -((t.clientY - rect.top)/rect.height)*2 + 1;
        raycaster.setFromCamera(mouse, camera);
        const meshes = planets.map(p=>p.mesh);
        const hits = raycaster.intersectObjects(meshes, false);
        if(hits.length){
          const p = hits[0].object;
          const target = p.getWorldPosition(new THREE.Vector3());
          controls.target.copy(target);
          const dir = camera.position.clone().sub(target).normalize();
          const dist = p.geometry.parameters.radius * 10 + 120;
          camera.position.copy(target.clone().add(dir.multiplyScalar(dist)));
          controls.update();
        }
      }
      lastTap = now;
    }, {passive:true});

    // Animaci√≥n
    let t = 0;
    function tick(){
      const dt = 0.016; t += dt;
      planets.forEach((p,i)=>{
        p.pivot.rotation.y += p.speed*dt;   // √≥rbita
        p.mesh.rotation.y += 0.005 + i*0.001; // rotaci√≥n propia
      });
      sun.rotation.y += 0.0025;
      starGroup.rotation.y += 0.0005;
      controls.update();
      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
      requestAnimationFrame(tick);
    }

    // Resize
    function onResize(){
      const wrap = document.querySelector('.universe');
      const w = wrap.clientWidth, h = wrap.clientHeight;
      renderer.setSize(w, h, false);
      labelRenderer.setSize(w, h);
      camera.aspect = w / h; camera.updateProjectionMatrix();
    }
    window.addEventListener('resize', onResize);
    onResize();
    tick();

    // Activo en tabs
    (function(){
      const tabs = document.querySelectorAll('.tabs .tab');
      const current = (location.pathname.split('/').pop() || 'sistema-solar.html').toLowerCase();
      tabs.forEach(a=>{ const href=(a.getAttribute('href')||'').toLowerCase(); if(href===current) a.classList.add('is-active'); else a.classList.remove('is-active'); });
    })();
  </script>
</body>
</html>
